import{B as te,c as B,$ as re,a0 as oe,a1 as ne,R as se,b as ae,a2 as M,e as ie,d as ce,f as G,g as le,h as Y,k as de,C as d,l as Q,s as ue,m as ge,n as f,q as p,r as fe,p as pe,E as be,D as F,M as Ce,N as xe,x as me,y as he,v as ye,a3 as Se,A as ve,G as Le,o as V,H as Te,I as Ee,j as we,z as Re,Q as ke,S as k,w as J,T as Ie,V as _e,Y as Oe,X as Ae,W as Pe,U as Me,_ as De}from"./bufferedData-Bfc_pTqn.js";import{f as I,W as Ge,b as Ue,G as Z,X as S,ah as Be,ai as H,q as Fe,r as N,v as He,aj as K,V as u,N as Ne,B as A,n as _,C as je,I as ze,m as E,H as Ke,K as j,p as We,U as $e,ak as Xe,al as Ye,am as Qe,an as Ve,M as Je,R as U,ao as Ze,ap as qe,aq as et,ag as tt}from"./resourceUtils-CpcWtzjX.js";function O(e,t,n){const o=n.getHandler(),r=Array.isArray(o)?o:[o];return W[e]>=W[n.getLevel()]&&r.includes(t)}const c={ok:"ok",debug:"debug",info:"info",notice:"notice",warn:"warn",error:"error",critical:"critical",alert:"alert",emerg:"emerg"},W={[c.ok]:0,[c.debug]:1,[c.info]:2,[c.notice]:4,[c.warn]:5,[c.error]:6,[c.critical]:7,[c.alert]:8,[c.emerg]:9};function P(e,{includeMessage:t=!1}={}){return{stack:e.stack,kind:e.type,message:t?e.message:void 0,causes:e.causes,fingerprint:e.fingerprint,handling:e.handling}}var rt=function(e,t,n,o){var r=arguments.length,s=r<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,n):o,i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,n,s):i(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};const w={console:"console",http:"http",silent:"silent"},ot=Object.keys(c);class C{constructor(t,n,o=w.http,r=c.debug,s={}){this.handleLogStrategy=t,this.handlerType=o,this.level=r,this.contextManager=te("logger"),this.tags=[],this.contextManager.setContext(s),n&&this.contextManager.setContextProperty("logger",{name:n})}logImplementation(t,n,o=c.info,r,s){const i=I(n);let a;if(r!=null){const l=Ge({originalError:r,nonErrorPrefix:"Provided",source:S.LOGGER,handling:"handled",startClocks:Ue()});a=B({error:P(l,{includeMessage:!0})},l.context,i)}else a=i;this.handleLogStrategy({message:I(t),context:a,status:o},this,s)}log(t,n,o=c.info,r){let s;O(o,w.http,this)&&(s=Z("log")),this.logImplementation(t,n,o,r,s)}setContext(t){this.contextManager.setContext(t)}getContext(){return this.contextManager.getContext()}setContextProperty(t,n){this.contextManager.setContextProperty(t,n)}removeContextProperty(t){this.contextManager.removeContextProperty(t)}clearContext(){this.contextManager.clearContext()}addTag(t,n){this.tags.push(re(t,n))}removeTagsWithKey(t){const n=oe(t);this.tags=this.tags.filter(o=>o!==n&&!o.startsWith(`${n}:`))}getTags(){return this.tags.slice()}setHandler(t){this.handlerType=t}getHandler(){return this.handlerType}setLevel(t){this.level=t}getLevel(){return this.level}}rt([Be],C.prototype,"logImplementation",null);C.prototype.ok=y(c.ok);C.prototype.debug=y(c.debug);C.prototype.info=y(c.info);C.prototype.notice=y(c.notice);C.prototype.warn=y(c.warn);C.prototype.error=y(c.error);C.prototype.critical=y(c.critical);C.prototype.alert=y(c.alert);C.prototype.emerg=y(c.emerg);function y(e){return function(t,n,o){let r;O(e,w.http,this)&&(r=Z("log")),this.logImplementation(t,n,e,o,r)}}function $(){return H?{}:{view:{referrer:document.referrer,url:window.location.href}}}const nt=32*Ne;function st(e,t){e.usePciIntake===!0&&e.site&&e.site!=="datadoghq.com"&&N.warn("PCI compliance for Logs is only available for Datadog organizations in the US1 site. Default intake will be used.");const n=He(e,t),o=X(e.forwardConsoleLogs,K(u),"Forward Console Logs"),r=X(e.forwardReports,K(se),"Forward Reports");if(!(!n||!o||!r))return e.forwardErrorsToLogs&&!o.includes(u.error)&&o.push(u.error),{forwardErrorsToLogs:e.forwardErrorsToLogs!==!1,forwardConsoleLogs:o,forwardReports:r,requestErrorResponseLengthLimit:nt,...n}}function X(e,t,n){if(e===void 0)return[];if(!(e==="all"||Array.isArray(e)&&e.every(o=>t.includes(o)))){N.error(`${n} should be "all" or an array with allowed values "${t.join('", "')}"`);return}return e==="all"?t:ne(e)}function at(e){const t=Fe(e);return{forward_errors_to_logs:e.forwardErrorsToLogs,forward_console_logs:e.forwardConsoleLogs,forward_reports:e.forwardReports,use_pci_intake:e.usePciIntake,...t}}function it(e,t,n){const o=de(),r=ae();M(r,d.globalContext,o);const s=ie();M(s,d.accountContext,o);const i=ce();M(i,d.userContext,o);let a,l;const b=t.observable.subscribe(m);function m(){if(!l||!a||!t.isGranted())return;b.unsubscribe();const g=n(a,l);o.drain(g)}return{init(g,v){if(!g){N.error("Missing configuration");return}if(je(g.enableExperimentalFeatures),G()&&(g=ct(g)),a=g,le(at(g)),l){Q("DD_LOGS",g);return}const x=st(g,v);x&&(l=x,Y().subscribe(_),t.tryToInit(x.trackingConsent),m())},get initConfiguration(){return a},globalContext:r,accountContext:s,userContext:i,getInternalContext:_,handleLog(g,v,x,L=e(),T=A()){o.add(h=>h.handleLog(g,v,x,L,T))}}}function ct(e){return{...e,clientToken:"empty"}}function lt(e){const t=ze(),n=ue().observable;let o=it($,t,(a,l)=>{const b=e(l,$,t,n);return o=dt(a,b),b});const r=()=>o,s={},i=new C((...a)=>o.handleLog(...a));return ge({logger:i,init:a=>{const l=new Error().stack;Ke(()=>o.init(a,l))},setTrackingConsent:E(a=>{t.update(a),pe({feature:"set-tracking-consent",tracking_consent:a})}),getGlobalContext:f(r,d.globalContext,p.getContext),setGlobalContext:f(r,d.globalContext,p.setContext),setGlobalContextProperty:f(r,d.globalContext,p.setContextProperty),removeGlobalContextProperty:f(r,d.globalContext,p.removeContextProperty),clearGlobalContext:f(r,d.globalContext,p.clearContext),createLogger:E((a,l={})=>(s[a]=new C((...b)=>o.handleLog(...b),I(a),l.handler,l.level,I(l.context)),s[a])),getLogger:E(a=>s[a]),getInitConfiguration:E(()=>fe(o.initConfiguration)),getInternalContext:E(a=>o.getInternalContext(a)),setUser:f(r,d.userContext,p.setContext),getUser:f(r,d.userContext,p.getContext),setUserProperty:f(r,d.userContext,p.setContextProperty),removeUserProperty:f(r,d.userContext,p.removeContextProperty),clearUser:f(r,d.userContext,p.clearContext),setAccount:f(r,d.accountContext,p.setContext),getAccount:f(r,d.accountContext,p.getContext),setAccountProperty:f(r,d.accountContext,p.setContextProperty),removeAccountProperty:f(r,d.accountContext,p.removeContextProperty),clearAccount:f(r,d.accountContext,p.clearContext)})}function dt(e,t){return{init:n=>{Q("DD_LOGS",n)},initConfiguration:e,...t}}const ut="logs";function gt(e,t){const n=be(e,ut,o=>q(e,o),t);return{findTrackedSession:(o,r={returnInactive:!1})=>{const s=n.findSession(o,r);return s&&s.trackingType==="1"?{id:s.id,anonymousId:s.anonymousId}:void 0},expireObservable:n.expireObservable}}function ft(e){const n=q(e)==="1"?{}:void 0;return{findTrackedSession:()=>n,expireObservable:new j}}function q(e,t){return pt(t)?t:We(e.sessionSampleRate)?"1":"0"}function pt(e){return e==="0"||e==="1"}function bt(e,t,n,o,r,s){const i=ot.concat(["custom"]),a={};i.forEach(l=>{a[l]=xe(l,r,s)}),t.subscribe(0,({rawLogsEvent:l,messageContext:b=void 0,savedCommonContext:m=void 0,domainContext:g,ddtags:v=[]})=>{var x,L;const T=$e(l.date),h=m||o(),z=n.triggerHook(0,{startTime:T});if(z===F)return;const ee=Ce(e),R=B({view:h.view},z,l,b,{ddtags:ee.concat(v).join(",")});((x=e.beforeSend)===null||x===void 0?void 0:x.call(e,R,g))===!1||R.origin!==S.AGENT&&((L=a[R.status])!==null&&L!==void 0?L:a.custom).isLimitReached()||t.notify(1,R)})}const Ct={[u.log]:c.info,[u.debug]:c.debug,[u.info]:c.info,[u.warn]:c.warn,[u.error]:c.error};function xt(e,t){const n=me(e.forwardConsoleLogs).subscribe(o=>{var r;const s={rawLogsEvent:{date:A(),message:o.message,origin:S.CONSOLE,error:o.error&&P(o.error),status:Ct[o.api]},messageContext:(r=o.error)===null||r===void 0?void 0:r.context,domainContext:{handlingStack:o.handlingStack}};t.notify(0,s)});return{stop:()=>{n.unsubscribe()}}}function mt(e,t){const n=he(e,e.forwardReports).subscribe(o=>{let r=o.message,s;const i=o.originalError.type==="deprecation"?c.warn:c.error;i===c.error?s=P(o):o.stack&&(r+=` Found in ${Xe(o.stack)}`),t.notify(0,{rawLogsEvent:{date:A(),message:r,origin:S.REPORT,error:s,status:i}})});return{stop:()=>{n.unsubscribe()}}}function ht(e,t){if(!e.forwardErrorsToLogs)return{stop:_};const n=(H?new j:ye(e)).subscribe(i=>{i.state==="complete"&&s(U.XHR,i)}),o=Y({responseBodyAction:i=>r(i)?2:0}).subscribe(i=>{i.state==="resolve"&&s(U.FETCH,i)});function r(i){return!Ye(i.url)&&(yt(i)||Se(i.status))}function s(i,a){if(!r(a))return;const l="error"in a&&a.error?Qe(Ve(a.error)):a.responseBody||"Failed to load",b={isAborted:a.isAborted,handlingStack:a.handlingStack};t.notify(0,{rawLogsEvent:{message:`${St(i)} error ${a.method} ${a.url}`,date:a.startClocks.timeStamp,error:{stack:Je(l,e.requestErrorResponseLengthLimit,"..."),handling:void 0},http:{method:a.method,status_code:a.status,url:a.url},status:c.error,origin:S.NETWORK},domainContext:b})}return{stop:()=>{n.unsubscribe(),o.unsubscribe()}}}function yt(e){return e.status===0&&e.responseType!=="opaque"}function St(e){return U.XHR===e?"XHR":"Fetch"}function vt(e,t,n){if(!e.forwardErrorsToLogs)return{stop:_};const o=n.subscribe(r=>{if(r.type===0){const s=r.error;t.notify(0,{rawLogsEvent:{message:s.message,date:s.startClocks.timeStamp,error:P(s),origin:S.SOURCE,status:c.error},messageContext:s.context})}});return{stop:()=>{o.unsubscribe()}}}const Lt=ve;function Tt(e){function t(n,o,r,s,i){const a=B(o.getContext(),n.context);if(O(n.status,w.console,o)&&wt(n,a),O(n.status,w.http,o)){const l={rawLogsEvent:{date:i||A(),message:n.message,status:n.status,origin:S.LOGGER},messageContext:a,savedCommonContext:s,ddtags:o.getTags()};r&&(l.domainContext={handlingStack:r}),e.notify(0,l)}}return{handleLog:t}}const Et={[c.ok]:u.debug,[c.debug]:u.debug,[c.info]:u.info,[c.notice]:u.info,[c.warn]:u.warn,[c.error]:u.error,[c.critical]:u.error,[c.alert]:u.error,[c.emerg]:u.error};function wt({status:e,message:t},n){Ze[Et[e]].call(qe,t,n)}function Rt(e,t,n,o,r){const s=[e.logsEndpointBuilder];e.replica&&s.push(e.replica.logsEndpointBuilder);const i=Le({encoder:V(),request:Ee(s,n),flushController:Te({pageMayExitObservable:o,sessionExpireObservable:r.expireObservable})});return t.subscribe(1,a=>{i.add(a)}),i}function kt(e){const t=we();e.subscribe(1,n=>{t.send("log",n)})}function It(e){return{get:t=>{const n=e.findTrackedSession(t);if(n)return{session_id:n.id}}}}function _t(e){return t=>{e.notify(0,{rawLogsEvent:{message:t.message,date:t.startClocks.timeStamp,origin:S.AGENT,status:c.error}}),Re("Error reported to customer",{"error.message":t.message})}}const Ot=ke;function At(e){const t=et;e.register(0,({startTime:r})=>{const s=n(r);return s||k}),e.register(1,({startTime:r})=>{var s,i;const a=n(r);return a?{application:{id:a.application_id},view:{id:(s=a.view)===null||s===void 0?void 0:s.id},action:{id:(i=a.user_action)===null||i===void 0?void 0:i.id}}:k});function n(r){const i=J()?t.DD_RUM_SYNTHETICS:t.DD_RUM,a=o(r,i);if(a)return a}function o(r,s){if(s&&s.getInternalContext)return s.getInternalContext(r)}}function Pt(e,t,n){e.register(0,({startTime:o})=>{const r=n.findTrackedSession(o);return n.findTrackedSession(o,{returnInactive:!0})?{service:t.service,session_id:r?r.id:void 0,session:r?{id:r.id}:void 0}:F}),e.register(1,({startTime:o})=>{const r=n.findTrackedSession(o);return!r||!r.id?k:{session:{id:r.id}}})}function Mt(e,t){function n(){return t.isGranted()?k:F}e.register(0,n),e.register(1,n)}const D="logs";function Dt(e,t,n,o){const r=new Lt,s=Ot(),i=[];r.subscribe(1,h=>Ie("logs",h));const a=_t(r),l=H?new j:Me(e),b=_e("browser-logs-sdk",e,s,a,l,V);i.push(b.stop);const m=e.sessionStoreStrategyType&&!G()&&!J()?gt(e,n):ft(e);Mt(s,n),Pt(s,e,m);const g=Oe(s,e,D),v=Ae(s,e,m,D),x=Pe(s,e,D,!1);At(s),ht(e,r),vt(e,r,o),o.unbuffer(),xt(e,r),mt(e,r);const{handleLog:L}=Tt(r);if(bt(e,r,s,t,a),G())kt(r);else{const{stop:h}=Rt(e,r,a,l,m);i.push(()=>h())}const T=It(m);return{handleLog:L,getInternalContext:T.get,accountContext:g,globalContext:x,userContext:v,stop:()=>{i.forEach(h=>h())}}}const Gt=lt(Dt);De(tt(),"DD_LOGS",Gt);export{w as HandlerType,C as Logger,c as StatusType,Gt as datadogLogs};
//# sourceMappingURL=main-D-z-Ugz8.js.map
